select
    l.PLAN_LINE_ID,
    l.PLAN_ID,
    l.INSTANCE_ID,
    l.INSPECTION_ID,
    l.DESCRIPTION,
    l.ORGANIZATION_ID,
    --l.ORGANIZATION_NAME,
    l.INSTANCE_NUMBER,
    l.POSITION_ID,
    l.POSITION_NUMBER,
    l.LOCATION_CODE,
    l.DEPARTMENT_NAME,
    l.INSPECTION_DATE,
    l.COMPLETION_DATE,
    (select count(*) from XXMOBILE_INSPECTION_LINES t where t.INSPECTION_ID = l.INSPECTION_ID and t.DEFAULT_RESULT != t.CURRENT_RESULT) as FAILED_COUNT,
    (select count(*) from XXMOBILE_TAGS t join XXEAM.XXMOBILE_TAG_OBJECTS o on t.REMOVED_DATE is NULL and o.SERIAL_NUMBER = t.SERIAL_NUMBER where o.OBJECT_TYPE = 1 and o.OBJECT_ID = l.INSTANCE_ID and o.REMOVED_DATE is NULL) as TAGS_COUNT,
    l.CREATION_DATE as CREATED_AT,
    l.CREATED_BY,   
    l.LAST_UPDATE_DATE as UPDATED_AT,
    l.LAST_UPDATED_BY as UPDATED_BY,
    null as REMOVED_AT,
    null as REMOVED_BY
from XXMOBILE_PLAN_LINES_V l
where 1=1
    /*%CONDITIONS%*/
/*%SORTING%*/
fetch first :p_limit rows only
